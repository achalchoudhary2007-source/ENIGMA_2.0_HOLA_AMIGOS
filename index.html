<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus ML | Interactive AI Sandbox</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#4f46e5', secondary: '#0f172a' }
                }
            }
        }
    </script>
    <style>
        .view-section { display: none; animation: fadeIn 0.3s ease-in-out; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans min-h-screen flex flex-col">

    <nav class="bg-white border-b border-slate-200 shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center cursor-pointer" onclick="navigateTo('home')">
                    <i class="fa-solid fa-brain text-primary text-2xl mr-2"></i>
                    <span class="font-bold text-xl tracking-tight text-secondary">Nexus ML</span>
                </div>
                <div class="flex items-center space-x-6">
                    <a href="#" onclick="navigateTo('home')" class="text-slate-500 hover:text-primary font-medium transition">Dashboard</a>
                    <a href="#" onclick="navigateTo('simulator')" class="text-slate-500 hover:text-primary font-medium transition">Simulator</a>
                    <div class="border-l border-slate-300 h-6 mx-2"></div>
                    <a href="#" onclick="navigateTo('login')" class="text-slate-500 hover:text-primary font-medium transition">Log in</a>
                    <button onclick="navigateTo('register')" class="bg-primary hover:bg-indigo-700 text-white px-4 py-2 rounded-md font-medium transition shadow-md">
                        Sign up free
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-grow flex flex-col">

        <section id="view-home" class="view-section active flex-grow">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 text-center">
                <h1 class="text-5xl font-extrabold text-secondary tracking-tight mb-4">
                    Master Machine Learning <br><span class="text-transparent bg-clip-text bg-gradient-to-r from-primary to-cyan-500">Visually.</span>
                </h1>
                <p class="text-xl text-slate-500 mb-10 max-w-2xl mx-auto">
                    Stop guessing how algorithms work. Watch neural networks learn, manipulate gradient descent in real-time, and combat overfitting with our interactive sandbox.
                </p>
                <button onclick="navigateTo('simulator')" class="bg-primary hover:bg-indigo-700 text-white px-8 py-4 rounded-lg font-bold text-lg transition shadow-xl transform hover:-translate-y-1">
                    Launch Simulator <i class="fa-solid fa-rocket ml-2"></i>
                </button>

                <div class="mt-20 grid grid-cols-1 md:grid-cols-3 gap-8 text-left">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center text-xl mb-4"><i class="fa-solid fa-chart-line"></i></div>
                        <h3 class="text-xl font-bold mb-2">Gradient Descent</h3>
                        <p class="text-slate-500 text-sm">Visualize how algorithms minimize loss mathematically step-by-step.</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <div class="w-12 h-12 bg-purple-100 text-purple-600 rounded-lg flex items-center justify-center text-xl mb-4"><i class="fa-solid fa-balance-scale"></i></div>
                        <h3 class="text-xl font-bold mb-2">Overfitting Control</h3>
                        <p class="text-slate-500 text-sm">Tweak polynomial degrees and watch the variance vs. bias tradeoff unfold.</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <div class="w-12 h-12 bg-emerald-100 text-emerald-600 rounded-lg flex items-center justify-center text-xl mb-4"><i class="fa-solid fa-network-wired"></i></div>
                        <h3 class="text-xl font-bold mb-2">Neural Architectures</h3>
                        <p class="text-slate-500 text-sm">Understand perceptrons and multi-layer networks through interactive training data.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="view-login" class="view-section flex-grow flex items-center justify-center py-12">
            <div class="bg-white p-8 rounded-2xl shadow-xl border border-slate-100 w-full max-w-md">
                <div class="text-center mb-8">
                    <i class="fa-solid fa-brain text-primary text-4xl mb-2"></i>
                    <h2 class="text-2xl font-bold text-secondary">Welcome back</h2>
                    <p class="text-slate-500 text-sm">Enter your credentials to access your saved models.</p>
                </div>
                <form onsubmit="event.preventDefault(); navigateTo('simulator');">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Email Address</label>
                        <input type="email" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Password</label>
                        <input type="password" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none" required>
                    </div>
                    <button type="submit" class="w-full bg-secondary hover:bg-slate-800 text-white font-bold py-3 px-4 rounded-lg transition shadow-md">
                        Sign In
                    </button>
                </form>
                <p class="text-center text-sm text-slate-500 mt-6">
                    Don't have an account? <a href="#" onclick="navigateTo('register')" class="text-primary font-bold hover:underline">Sign up</a>
                </p>
            </div>
        </section>

        <section id="view-register" class="view-section flex-grow flex items-center justify-center py-12">
            <div class="bg-white p-8 rounded-2xl shadow-xl border border-slate-100 w-full max-w-md">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold text-secondary">Create an Account</h2>
                    <p class="text-slate-500 text-sm">Join Nexus ML and save your experiment progress.</p>
                </div>
                <form onsubmit="event.preventDefault(); navigateTo('simulator');">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Full Name</label>
                        <input type="text" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Email Address</label>
                        <input type="email" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Password</label>
                        <input type="password" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none" required>
                    </div>
                    <button type="submit" class="w-full bg-primary hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition shadow-md">
                        Create Account
                    </button>
                </form>
            </div>
        </section>

        <section id="view-simulator" class="view-section flex-grow bg-slate-100 p-6 h-[calc(100vh-4rem)]">
            <div class="flex h-full max-w-[1600px] mx-auto gap-6">
                <div class="w-1/4 bg-white p-6 rounded-xl shadow-sm border border-slate-200 overflow-y-auto">
                    <div class="mb-6">
                        <h2 class="text-xl font-bold text-secondary"><i class="fa-solid fa-sliders text-primary mr-2"></i> Parameters</h2>
                        <p class="text-xs text-slate-400 mt-1">Configure your model architecture</p>
                    </div>

                    <div class="mb-6">
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Algorithm Type</label>
                        <select id="algoSelect" class="w-full bg-slate-50 border border-slate-200 text-sm p-2 rounded-lg focus:ring-primary outline-none">
                            <option value="regression">Linear Regression (Gradient Descent)</option>
                            <option value="classification">Logistic Regression (Perceptron)</option>
                        </select>
                    </div>

                    <div class="space-y-5">
                        <div>
                            <label class="flex justify-between text-sm font-medium text-slate-700">Learning Rate (Î±) <span id="lrVal" class="text-primary font-mono bg-indigo-50 px-1 rounded">0.1</span></label>
                            <input type="range" id="lr" min="0.01" max="0.5" step="0.01" value="0.1" class="w-full mt-2 accent-primary" />
                        </div>
                        <div>
                            <label class="flex justify-between text-sm font-medium text-slate-700">Epochs <span id="epochsVal" class="text-primary font-mono bg-indigo-50 px-1 rounded">150</span></label>
                            <input type="range" id="epochs" min="10" max="500" step="10" value="150" class="w-full mt-2 accent-primary" />
                        </div>
                        <div id="degreeContainer">
                            <label class="flex justify-between text-sm font-medium text-slate-700">Polynomial Degree <span id="degreeVal" class="text-primary font-mono bg-indigo-50 px-1 rounded">1</span></label>
                            <input type="range" id="degree" min="1" max="9" step="1" value="1" class="w-full mt-2 accent-primary" />
                            <p class="text-[10px] text-red-500 mt-1 font-medium"><i class="fa-solid fa-triangle-exclamation"></i> High degrees cause Overfitting!</p>
                        </div>
                    </div>

                    <button id="trainBtn" class="w-full mt-8 bg-secondary hover:bg-slate-800 text-white font-bold py-3 rounded-lg shadow-md transition flex justify-center items-center gap-2">
                        <i class="fa-solid fa-play"></i> Run Simulation
                    </button>
                </div>

                <div class="w-3/4 flex flex-col gap-6">
                    <div class="flex-1 bg-white p-4 rounded-xl shadow-sm border border-slate-200 relative">
                        <div class="flex justify-between items-center mb-2">
                            <h2 class="font-bold text-secondary">Decision Boundary Visualization</h2>
                            <div id="statusBadge" class="bg-indigo-50 text-primary border border-indigo-100 px-3 py-1 rounded-full text-sm font-mono flex gap-3">
                                <span>Epoch: 0</span> <span>Loss: 0.0000</span>
                            </div>
                        </div>
                        <div class="h-[calc(100%-2rem)] w-full relative"><canvas id="scatterChart"></canvas></div>
                    </div>
                    
                    <div class="h-1/3 bg-white p-4 rounded-xl shadow-sm border border-slate-200 relative">
                        <h2 class="font-bold text-secondary mb-2">Gradient Descent Cost Function (Loss)</h2>
                        <div class="h-[calc(100%-2rem)] w-full relative"><canvas id="lossChart"></canvas></div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- Navigation Logic ---
        function navigateTo(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + viewId).classList.add('active');
            
            // Only initialize charts if we land on the simulator
            if(viewId === 'simulator' && !chartsInitialized) {
                initCharts();
                fetchData();
                chartsInitialized = true;
            }
        }

        // --- ML Simulator Logic ---
        let chartsInitialized = false;
        let datasetType = 'regression', dataX = [], dataY = [];
        let scatterChart, lossChart, animationInterval;
        
        const algoSelect = document.getElementById('algoSelect');
        const lrInput = document.getElementById('lr'), epochsInput = document.getElementById('epochs');
        const degreeInput = document.getElementById('degree'), trainBtn = document.getElementById('trainBtn');
        const statusBadge = document.getElementById('statusBadge');

        // Update UI labels
        lrInput.oninput = e => document.getElementById('lrVal').innerText = e.target.value;
        epochsInput.oninput = e => document.getElementById('epochsVal').innerText = e.target.value;
        degreeInput.oninput = e => document.getElementById('degreeVal').innerText = e.target.value;

        // Change Problem Type
        algoSelect.onchange = (e) => {
            datasetType = e.target.value;
            document.getElementById('degreeContainer').style.display = datasetType === 'regression' ? 'block' : 'none';
            fetchData();
        };

        function initCharts() {
            scatterChart = new Chart(document.getElementById('scatterChart').getContext('2d'), {
                type: 'scatter', data: { datasets: [] },
                options: { responsive: true, maintainAspectRatio: false, animation: false, scales: { x: { min: -1.2, max: 1.2 }, y: { min: -1.2, max: 2.5 } }, plugins: { legend: { position: 'bottom' } } }
            });
            lossChart = new Chart(document.getElementById('lossChart').getContext('2d'), {
                type: 'line', data: { labels: [], datasets: [{ label: 'Loss Value', data: [], borderColor: '#ef4444', backgroundColor: 'rgba(239, 68, 68, 0.1)', fill: true, tension: 0.1, pointRadius: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, animation: false, plugins: { legend: { display: false } } }
            });
        }

        async function fetchData() {
            try {
                const res = await axios.get(`http://localhost:8000/generate-data?type=${datasetType}`);
                dataX = res.data.X; dataY = res.data.y;
                updateCharts(null);
            } catch (err) { alert("Backend connection failed. Ensure python main.py is running on port 8000."); }
        }

        function updateCharts(frame, historyData = []) {
            let points = datasetType === 'regression' ? dataX.map((x, i) => ({ x, y: dataY[i] })) : dataX.map(x => ({ x: x[0], y: x[1] }));
            let colors = datasetType === 'regression' ? '#4f46e5' : dataY.map(y => y === 1 ? '#10b981' : '#f43f5e');

            scatterChart.data.datasets = [
                { label: 'Training Data', data: points, backgroundColor: colors },
                { label: 'Model Prediction', data: frame ? frame.boundary : [], type: 'line', borderColor: '#f59e0b', borderWidth: 3, pointRadius: 0, fill: false }
            ];
            scatterChart.update();

            if (frame) {
                statusBadge.innerHTML = `<span>Epoch: ${frame.epoch}</span> <span>Loss: ${frame.loss.toFixed(4)}</span>`;
                lossChart.data.labels = historyData.map(h => h.epoch);
                lossChart.data.datasets[0].data = historyData.map(h => h.loss);
                lossChart.update();
            } else {
                statusBadge.innerHTML = `<span>Epoch: 0</span> <span>Loss: 0.0000</span>`;
                lossChart.data.labels = []; lossChart.data.datasets[0].data = [];
                lossChart.update();
            }
        }

        trainBtn.onclick = async () => {
            clearInterval(animationInterval);
            trainBtn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> Training...`; 
            trainBtn.disabled = true;

            const payload = {
                learning_rate: parseFloat(lrInput.value),
                epochs: parseInt(epochsInput.value),
                degree: datasetType === 'regression' ? parseInt(degreeInput.value) : 1,
                X: dataX, y: dataY
            };

            try {
                const endpoint = datasetType === 'regression' ? 'train-linear' : 'train-logistic';
                const res = await axios.post(`http://localhost:8000/${endpoint}`, payload);
                const historyData = res.data.history;
                
                let step = 0;
                animationInterval = setInterval(() => {
                    if (step >= historyData.length) {
                        clearInterval(animationInterval);
                        trainBtn.innerHTML = `<i class="fa-solid fa-play"></i> Run Simulation`; 
                        trainBtn.disabled = false;
                        return;
                    }
                    updateCharts(historyData[step], historyData.slice(0, step + 1));
                    step++;
                }, 50);
            } catch (err) { console.error(err); trainBtn.innerHTML = `Error!`; trainBtn.disabled = false; }
        };
    </script>
</body>
</html>